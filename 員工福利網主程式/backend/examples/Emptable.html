<!--
=========================================================
 Light Bootstrap Dashboard - v2.0.1
=========================================================

 Product Page: https://www.creative-tim.com/product/light-bootstrap-dashboard
 Copyright 2019 Creative Tim (https://www.creative-tim.com)
 Licensed under MIT (https://github.com/creativetimofficial/light-bootstrap-dashboard/blob/master/LICENSE)

 Coded by Creative Tim

=========================================================

 The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.  -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="../assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Light Bootstrap Dashboard - Free Bootstrap 4 Admin Dashboard by Creative Tim</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
        name='viewport' />
    <!--     Fonts and icons     -->

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/css/light-bootstrap-dashboard.css?v=2.0.0 " rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="../assets/css/demo.css" rel="stylesheet" />
    <script defer src="https://use.fontawesome.com/releases/v5.0.10/js/all.js"
        integrity="sha384-slN8GvtUJGnv6ca26v8EzVaR9DC58QEwsIk9q1QXdCU8Yu8ck/tL/5szYlBbqmS+"
        crossorigin="anonymous"></script>

    <style>
        .fa-edit,
        .fa-trash-alt {
            margin-left: 10px;
        }

        .search_txt {
            margin-right: 5px;
            margin-left: 3px;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-image="../assets/img/sidebar-5.jpg">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

        Tip 2: you can also add an image using data-image tag
    -->
            <div class="sidebar-wrapper">
                <div class="logo">
                    <a href="" class="simple-text">
                        員工福利網
                    </a>
                </div>
                <ul class="nav">
                    <li>
                        <a class="nav-link" href="index.html">
                            <i class="nc-icon nc-chart-pie-35"></i>
                            <p>主頁</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./Blogtable.html">
                            <i class="nc-icon nc-notes"></i>
                            <p>部落格</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./Emptable.html">
                            <i class="nc-icon nc-notes"></i>
                            <p>員工</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./Flowtable.html">
                            <i class="nc-icon nc-notes"></i>
                            <p>開團</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./Forum.html">
                            <i class="nc-icon nc-notes"></i>
                            <p>討論區</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./Protable.html">
                            <i class="nc-icon nc-notes"></i>
                            <p>團購</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg " color-on-scroll="500">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#pablo"> Table List </a>
                    <button href="" class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                        aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end" id="navigation">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="#pablo">
                                    <span class="no-icon" onclick="logOut()">Log out</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card strpied-tabled-with-hover">
                                <div class="card-header ">
                                    <h4 class="card-title">Striped Table with Hover</h4>
                                    <p class="card-category">Here is a subtitle for this table</p>
                                </div>
                                <div class="card-body table-full-width table-responsive">
                                    <table class="table table-hover table-striped">
                                        <thead>
                                            <input type="text" class="search_txt" placeholder="搜尋ID" id="srchtxt_ID">
                                            <button><i class="fas fa-search" onclick="`${getDataKey()}`"></i></button>

                                            <th>ID</th>
                                            <th>姓名</th>
                                            <th>帳號</th>
                                            <th>密碼</th>
                                            <th>部門</th>
                                            <th>電話號碼</th>
                                            <th>信箱</th>
                                            <th>住址</th>
                                            <th>入職日期</th>
                                            <th>交通工具</th>
                                            <th>員工狀態</th>
                                            <th>修改</th>


                                        </thead>
                                        <tbody id="tr_member">
                                            <!-- <tr>
                                                <td>1</td>
                                                <td>Dakota Rice</td>
                                                <td>$36,738</td>
                                                <td>Niger</td>
                                                <td>Oud-Turnhout</td>
                                            </tr> -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="card card-plain table-plain-bg">
                                <div class="card-header ">

                                </div>
                                <!-- <div class="card-body table-full-width table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Salary</th>
                                            <th>Country</th>
                                            <th>City</th>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <td>Dakota Rice</td>
                                                <td>$36,738</td>
                                                <td>Niger</td>
                                                <td>Oud-Turnhout</td>
                                            </tr>
                                            <tr>
                                                <td>2</td>
                                                <td>Minerva Hooper</td>
                                                <td>$23,789</td>
                                                <td>Curaçao</td>
                                                <td>Sinaai-Waas</td>
                                            </tr>
                                            <tr>
                                                <td>3</td>
                                                <td>Sage Rodriguez</td>
                                                <td>$56,142</td>
                                                <td>Netherlands</td>
                                                <td>Baileux</td>
                                            </tr>
                                            <tr>
                                                <td>4</td>
                                                <td>Philip Chaney</td>
                                                <td>$38,735</td>
                                                <td>Korea, South</td>
                                                <td>Overland Park</td>
                                            </tr>
                                            <tr>
                                                <td>5</td>
                                                <td>Doris Greene</td>
                                                <td>$63,542</td>
                                                <td>Malawi</td>
                                                <td>Feldkirchen in Kärnten</td>
                                            </tr>
                                            <tr>
                                                <td>6</td>
                                                <td>Mason Porter</td>
                                                <td>$78,615</td>
                                                <td>Chile</td>
                                                <td>Gloucester</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="container-fluid">


                    <p class="copyright text-center">
                    <nav>
                        <p class="copyright text-center">
                            © xxxxx有限公司
                        </p>
                    </nav>

                </div>
            </footer>
        </div>
    </div>
</body>

<!--   Core JS Files   -->
<script src="../assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="../assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="../assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="../assets/js/plugins/bootstrap-switch.js"></script>
<!--  Google Maps Plugin    -->
<!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script> -->
<!--  Chartist Plugin  -->
<script src="../assets/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="../assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
<script src="../assets/js/light-bootstrap-dashboard.js?v=2.0.0 " type="text/javascript"></script>
<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
<script src="../assets/js/demo.js"></script>


<script>
    const request = new XMLHttpRequest();
    jQuery.support.cors = true;

    const content_tpl = tpl => {
        return `
        <tr>
            <td>${tpl.id}</td>
            <td contentEditable="true" id="name${tpl.id}">${tpl.name}</td>
            <td contentEditable="true" id="empAcc${tpl.id}">${tpl.empAcc}</td>
            <td contentEditable="true" id="Pw${tpl.id}">${tpl.Pw}</td>
            <td contentEditable="true" id="dept${tpl.id}">${tpl.dept}</td>
            <td contentEditable="true" id="phone${tpl.id}" >${tpl.phone}</td>
            <td contentEditable="true" id="Email${tpl.id}">${tpl.Email}</td>
            <td contentEditable="true" id="address${tpl.id}">${tpl.address}</td>
            <td contentEditable="true" id="hireDate${tpl.id}">${tpl.hireDate}</td>
            <td contentEditable="true" id="transport${tpl.id}">${tpl.transport}</td>
            <td contentEditable="true" id="state${tpl.id}">${tpl.state}</td>
            <td><button onclick="putEditData(${tpl.id})">修改<i class="fas fa-edit"></i></button></td>                  
         </tr>
        `
    }

    const sendHttpRequest = (method, url, data) => {  //fetch的上半部整理成function
        return fetch(url, {
            method: method,
            body: JSON.stringify(data),
            headers: data ? { 'Content-Type': 'application/json', } : {
                Authorization:
                    'Bearer ' + localStorage.getItem("token")
            } //{}裡面可放物件//三元表達式
        })  //get data  
            .then(response => {
                if (response.status >= 400) {       //參考xml httprequest對於錯誤的處理方法
                    //!response.ok
                    return response.json().then(errResData => {
                        const error = new Error('Something went wrong!');
                        error.data = errResData;   //找出錯誤的資料為何
                        throw error;
                    });
                }
                return response.json();
            })
    }

    //======get=====
    const getData = () => {
        sendHttpRequest('get', 'https://localhost:44310/api/memberback')
            .then(responseData => {
                let str = '';
                responseData.ftable.forEach(i => {
                    count = i.count;
                    str += content_tpl(i);
                })
                $('#tr_member').html(str);
            })
    };
    request.onload = getData();

    //=======get search======
    const getDataKey = () => {
        const url = `https://localhost:44310/api/memberback/?searchID=${srchtxt_ID.value}`
        sendHttpRequest('get', url)
            .then(responseData => {
                let str = '';
                responseData.ftable.forEach(i => {
                    count = i.count;
                    str += content_tpl(i);
                })
                $('#tr_member').html(str);
                // request.onload = getData();
                console.log(srchtxt_ID.value)
            })

    };

    //=======edit======

    const putEditData = (id) => {
        // currentPost.iID
        console.log("123");
        const name = document.querySelector(`#name${id}`).innerText;
        const empAcc = document.querySelector(`#empAcc${id}`).innerText;
        const Pw = document.querySelector(`#Pw${id}`).innerText
        const dept = document.querySelector(`#dept${id}`).innerText;
        const phone = document.querySelector(`#phone${id}`).innerText
        const Email = document.querySelector(`#Email${id}`).innerText;
        const address = document.querySelector(`#address${id}`).innerText;
        const hireDate = document.querySelector(`#hireDate${id}`).innerText;
        const transport = document.querySelector(`#transport${id}`).innerText
        const state = document.querySelector(`#state${id}`).innerText;

        let UrlPutID = `https://localhost:44310/api/memberback/?putID=${id}`
        sendHttpRequest('Put', UrlPutID, {
            "name": name,
            "empAcc": empAcc,
            "Pw": Pw,
            "dept": dept,
            "phone": phone,
            "Email": Email,
            "address": address,
            "hireDate": hireDate,
            "transport": transport,
            "state": state,

        }).then(responseData => {
            console.log(responseData);
            request.onload = getData();
        }).catch(err => {
            console.log(err, err.data);
        });

    };

    //========delete(不做刪除功能)======
    // const getData_delete = (id) => {
    //     var check = confirm("確定要刪除嗎?");
    //     if (!check) {
    //         return
    //     };
    //     let UrlDeleteID = `https://localhost:44310/api/memberback/?id=${id}`
    //     sendHttpRequest('Delete', UrlDeleteID
    //     ).then(responseData => {
    //         console.log(responseData);
    //         //console.log(typeof responseData);
    //         console.log(id);
    //         //console.log(message.fmessage);
    //         request.onload = getData();
    //     }).catch(err => {
    //         console.log(err, err.data);
    //     });

    // };

    // srchtxt_ID.addEventListener('change', (event) => { request.onload = getData() });

    function logOut() {
        location.href = "login.html"
        localStorage.removeItem("token");
    }
</script>

</html>