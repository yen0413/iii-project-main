@*@model IEnumerable<newBlogprj.Models.vmpurchase_open>*@
@model  IEnumerable<newBlogprj.Models.vm_purchaselist>

<!DOCTYPE html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>forums討論區 </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="site.webmanifest">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.ico">


    <!-- CSS here -->
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="../assets/css/flaticon.css">
    <link rel="stylesheet" href="../assets/css/slicknav.css">
    <link rel="stylesheet" href="../assets/css/animate.min.css">
    <link rel="stylesheet" href="../assets/css/magnific-popup.css">
    <link rel="stylesheet" href="../assets/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="../assets/css/themify-icons.css">
    <link rel="stylesheet" href="../assets/css/slick.css">
    <link rel="stylesheet" href="../assets/css/nice-select.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
          integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="../assets/fonts/fontawesome-free-5.14.0-web/css/all.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <style>
        .row {
            padding: -20px;
        }

        .push_right {
            display: flex;
            flex-direction: row-reverse;
        }

        .button_margin {
            margin: 10px;
        }

        .footer_range {
            margin-top: 40px;
        }

        /* .footer-end-social a,
        .footer_link a {
            font-size: 120%;
            color: black;
            text-decoration: none;
            margin: 5px;
        } */

        .footer-end-range {
            display: flex;
            justify-content: space-between;
            margin: auto;
            /* width: 900px; */
        }

        .response_range {
            display: flex;
        }

        .main_BCC {
            background-color: #FFF8D7;
            border-radius: 5px;
        }

        .text_mragin {
            margin-right: 10px;
        }

        .figure_range {
            margin: 5px;
        }

        .card {
            width: 460px;
            /*height: 440px;*/
            margin: 0 10px;
            /*margin-right: 80px;*/
            background-color: #c0dff1;
            /*border: 1px solid blue;*/
        }

        .card-body1 {
            /*border: 1px solid blue;*/
            padding: 10px;
            
            display: flex;
            justify-content: center;
        }
        .card-body2{
         
            
        }
        .card-textarea {
            /*border:1px solid green;*/
            width: 295px;
            display: flex;
        }

        .card-text1 {
            /*border: 1px solid red;*/
            margin: auto;
            width: 130px;
        }

        .p_area {
            /*border: 1px solid blue;*/
            /*width: 1200px;*/
            height: 2400px;
        }

        .p_area-card {
            /* border: 1px solid red; */
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .pa1 {
            /*border: 1px solid green;*/
            max-width: 1200px;
            height: 400px;
            display: flex;
            /*justify-content: space-around;*/
            justify-content: space-evenly;
            flex-wrap: wrap;
            padding-left: 20px;
        }

        .n {
            margin-top: -5px;
            padding-left: 10px;
            padding-right: 20px;
        }

        .btn1 {
            /*padding: 1px 1px;*/
            display: flex;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 35px;
            border-radius: 6px;
            background-color: #1E94A0;
        }

        .header-area {
            background-color: white;
        }

        header {
            background-color: #91D4C2;
        }

        body {
            background-color: #d5f0f0;
            padding-top: 0px;
            padding-bottom: 0px;
            padding-right: 0px !important;
        }
        .card-title{
            margin:auto;
        }
        .card-title1 {
            margin-left: 35%;
            margin-top: 10px;
        }

        .grounptitle {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #d5f0f0;
            height: 90px;
            margin-bottom: 20px;
        }

        hr {
            margin-top: 0px;
            margin-bottom: 0px;
        }

        .gpt {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .lastday{
            color:#FF2D2D;
            margin-left:10%;
            margin-right:30%;
        }
        .lgi1{
          margin-left:5%;
          margin-right:15%;
        }
    </style>
</head>

<body>

    <!-- Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="preloader-circle"></div>
                <div class="preloader-img pere-text">
                    @*<img src="../assets/img/logo.png" alt="">*@
                    <img src="~/assets/img/Gladxy_co._LOGO_Small.png" />
                </div>
            </div>
        </div>
    </div>
    <!-- Preloader Start -->
    <header>
        <!-- Header Start -->
        <div class="header-area" style="background-color: white;">
            <div class="main-header ">
                <div class="header-bottom  header-sticky">
                    <div class="container">
                        <div class="row align-items-center">
                            <!-- Logo -->
                            <div class="col-xl-2 col-lg-2 col-md-1">
                                <div class="logo">
                                    <a href="/cBlog/SecondStart"><img src="../assets/img/Gladxy_co._LOGO_Small.png" alt=""></a>
                                </div>
                            </div>
                            <h3 class="col-xl-2 col-lg-4 col-md-3" style="display:flex;justify-content:center;">員工福利網</h3>
                            <div class="col-xl-8 col-lg-6 col-md-8">
                                <!-- Main-menu -->
                                <div class="main-menu f-right d-none d-lg-block">
                                    <nav>
                                        <ul id="navigation">
                                            <li><a href="/cBlog/BlogList">部落格</a></li>

                                            <li><a href="/cBlog/ForumList">討論區</a></li>
                                            <li class="nav-item dropdown">
                                                <a class="nav-link dropdown-toggle" href="/cBlog/PurchaseList" id="navbarDropdown"
                                                   role="button" data-toggle="dropdown" aria-haspopup="true"
                                                   aria-expanded="false">
                                                    揪團GO
                                                </a>
                                                <div class="dropdown-menu" aria-labelledby="navbarDropdown">

                                                    <a class=" dropdown-item" href="/cBlog/Purchase_Open" style="padding: 10px;">
                                                        我要開團
                                                    </a>
                                                    <div class="dropdown-divider"></div>
                                                    <a class=" dropdown-item" href="/cBlog/Purchase_OpenList" style="padding: 10px;">
                                                        開團紀錄
                                                    </a>
                                                    <div class="dropdown-divider"></div>
                                                    <a class="dropdown-item" href="/cBlog/Purchase_FollowList" style="padding: 10px;">
                                                        我的跟團
                                                    </a>


                                                </div>
                                            </li>

                                            <li><a href="/cBlog/Action">活動區</a></li>
                                            <li>歡迎 @ViewBag.LoginName </li>
                                            <li class="nav-item dropdown">
                                                <a class="nav-link dropdown-toggle" href="/cBlog/PurchaseList" id="navbarDropdown"
                                                   role="button" data-toggle="dropdown" aria-haspopup="true"
                                                   aria-expanded="false">
                                                    會員專區
                                                </a>
                                                <div class="dropdown-menu" aria-labelledby="navbarDropdown">

                                                    <a class=" dropdown-item" href="/cBlog/Purchase_OpenList" style="padding: 10px;">
                                                        我的開團
                                                    </a>
                                                    <div class="dropdown-divider"></div>
                                                    <a class=" dropdown-item" href="/cBlog/Purchase_FollowList" style="padding: 10px;">
                                                        我的跟團
                                                    </a>
                                                    @*<div class="dropdown-divider"></div>
                                                        <a class="dropdown-item" href="#" style="padding: 10px;">
                                                            我的郵件
                                                        </a>*@
                                                    @*<div class="dropdown-divider"></div>
                                                        <a class="dropdown-item" href="#" style="padding: 10px;">
                                                            我要發信
                                                        </a>*@
                                                    <div class="dropdown-divider"></div>
                                                    <a class="dropdown-item" href="/cBlog/MemberDataEdit/@ViewBag.enumber2" style="padding: 10px;">
                                                        修改資料
                                                    </a>
                                                    <div class="dropdown-divider"></div>
                                                    <a class="dropdown-item" href="/cBlog/Vote" style="padding: 10px;">
                                                        我要投票
                                                    </a>

                                                </div>
                                            </li>
                                            <li><a href="/cBlog/LogOut">登出</a></li>

                                        </ul>
                                    </nav>
                                </div>
                            </div>
                            <!-- Mobile Menu -->
                            <div class="col-12">
                                <div class="mobile_menu d-block d-lg-none"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header End -->
    </header>


    <div class="slider-area ">
        <!-- Mobile Menu -->
        <div class="single-slider slider-height2 d-flex align-items-center" data-background="../assets/img/sw.jpg">
            <div class="container">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="hero-cap text-center">
                            <h2 class="ftitle" ></h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="grounptitle" hidden>
            <h1>團購區</h1><input type="text" id="vmn" value="@ViewBag.enumber2" hidden/>
        </div>

    <main>
        <div class="container1">
            <div class="row">
                <div class="p_area">

                    <div class="gpt" id="gptable">

                    </div>



                    <div class="modal fade bd-example-modal-xl" id="creatorder" tabindex="-1" aria-labelledby="exampleModalLabel"
                         aria-hidden="true" style="margin-top: 15%;padding:10px;">
                        <div class="modal-dialog modal-sm">
                            <div class="modal-content">
                                <div id="creatorder">
                                    <form>
                                        <div class="form-row " style="margin-left: 25%;">
                                            <div class="form-group col-md-10">
                                                <label for="inputEmail4">訂購團編號</label>
                                                <input type="number" class="form-control" id="newordergroupid" disabled>
                                                <label for="inputEmail4" style="display: none;">商品編號</label>
                                                <input type="number" class="form-control" id="neworderproductid" style="display: none;"
                                                       disabled>
                                                <label for="inputEmail4">商品名稱</label>
                                                <input type="text" class="form-control" id="neworderproductname" disabled>
                                                <label for="to">訂購數量</label>
                                                <input type="number" class="form-control" id="neworderquantity">
                                            </div>
                                            <!-- <div class="form-group col-md-6">
                                                 <label for="from">訂購人編號</label>
                                                <input type="number" class="form-control" id="newordermemberid">

                                            </div> -->
                                            <!-- <div class="form-group col-md-6">
                                                <label for="from">訂購日期</label>
                                                <input type="date" class="form-control" id="neworderdate" style="margin-left: 10px;">
                                                <label for="to">訂購狀態</label>
                                                <input type="number" class="form-control" id="neworderstate" style="margin-left: 10px;">
                                            </div> -->
                                        </div>
                                    </form>
                                    <button class="btn btn-primary" onclick="sendData3()"
                                            style="margin-top: 10px; margin-left: 200px;margin-bottom:10px;">
                                        送出
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="modal fade bd-example-modal-xl" id="productlistu" tabindex="-1" aria-labelledby="exampleModalLabel"
                         aria-hidden="true" style="margin-top: 5%;">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content">
                                <table class="table table-hover table-striped" id="datatable">
                                    <thead>
                                        <tr>
                                            <th>購物團編號</th>
                                            <th>產品編號</th>
                                            <th>產品名稱</th>
                                            <th>產品價格</th>
                                            <th>產品訂購量</th>

                                            <th>產品描述</th>
                                            <th>產品圖片</th>
                                            <th>選擇商品</th>
                                            <!-- <th>刪除</th> -->
                                        </tr>
                                    </thead>
                                    <tbody id="groupproducttable">
                                        <!-- <tr>
                                            <td>charry</td>
                                            <td>14</td>
                                            <td>content</td>
                                            <td>datetime</td>
                                            <td><button onclick="MesDelete()">刪除<i class="fas fa-trash-alt"></i></button></td>
                                        </tr> -->

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>






                </div>
            </div>

        </div>

    </main>
    <footer>
        <div class="footer_range footer-area footer-padding footer-bg"
             data-background="../assets/img/footer_bg.jpg">
            <div class="container">
                <div class="footer-end-range footer_link">
                    <div class="col-xl-7 col-lg-7 col-md-7">
                        <div class="footer-end-left ">
                            <a href="#">公司主頁</a>
                            <a href="#">福委會主頁</a>
                            <a href="#">與我聯繫</a>
                            <a href="#">聲明事項</a>
                        </div>
                    </div>

                    <div class="col-xl-5 col-lg-5 col-md-5">
                        <div class="footer-social f-right">
                            <a href="#"><i class="fab fa-twitter"></i></a>
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-behance"></i></a>
                            <a href="#"><i class="fas fa-globe"></i></a>
                        </div>
                    </div>
                </div>
                <div class="footer-end-range">
                    <P>© 2020 Gladxy Daily. All rights reserved</P>
                </div>
            </div>

        </div>
    </footer>





    <!-- JS here -->
    <!-- All JS Custom Plugins Link Here here -->
    <script src="../assets/js/vendor/modernizr-3.5.0.min.js"></script>

    <!-- Jquery, Popper, Bootstrap -->
    <script src="../assets/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="../assets/js/popper.min.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <!-- Jquery Mobile Menu -->
    <script src="../assets/js/jquery.slicknav.min.js"></script>

    <!-- Jquery Slick , Owl-Carousel Plugins -->
    <script src="../assets/js/owl.carousel.min.js"></script>
    <script src="../assets/js/slick.min.js"></script>
    <!-- One Page, Animated-HeadLin -->
    <script src="../assets/js/wow.min.js"></script>
    <script src="../assets/js/animated.headline.js"></script>
    <script src="../assets/js/jquery.magnific-popup.js"></script>

    <!-- Scrollup, nice-select, sticky -->
    <script src="../assets/js/jquery.scrollUp.min.js"></script>
    <script src="../assets/js/jquery.nice-select.min.js"></script>
    <script src="../assets/js/jquery.sticky.js"></script>

    <!-- contact js -->
    <script src="../assets/js/contact.js"></script>
    <script src="../assets/js/jquery.form.js"></script>
    <script src="../assets/js/jquery.validate.min.js"></script>
    <script src="../assets/js/mail-script.js"></script>
    <script src="../assets/js/jquery.ajaxchimp.min.js"></script>

    <!-- Jquery Plugins, main Jquery -->
    <script src="../assets/js/plugins.js"></script>
    <script src="../assets/js/main.js"></script>

    <script>
        const request = new XMLHttpRequest();
        jQuery.support.cors = true;

        const v_url = '1fuen12iii.azurewebsites.net';

        const sendHttpRequest = (method, url, data) => {  //fetch的上半部整理成function
            return fetch(url, {
                method: method,
                body: JSON.stringify(data),
                headers: data ? { 'Content-Type': 'application/json', } : {} //{}裡面可放物件//三元表達式
            })  //get data
                .then(response => {
                    if (response.status >= 400) {       //參考xml httprequest對於錯誤的處理方法
                        //!response.ok
                        return response.json().then(errResData => {
                            const error = new Error('Something went wrong!');
                            error.data = errResData;   //找出錯誤的資料為何
                            throw error;
                        });
                    }
                    return response.json();
                })
        };
        const getData = () => {

            sendHttpRequest('get', 'https://' + v_url + '/api/gp')
                .then(responseData => {
                    let str = '';
                    responseData.gtable.forEach(i => {
                        count = i.count;
                        str += content_tpl(i);
                    })
                    $('#gptable').html(str);
                    console.log(responseData);
                })
        };
        const getData1 = (id) => {

            let UrlGetID = `https://${v_url}/api/gpproduct/${id}`
            sendHttpRequest('get', UrlGetID)

                .then(responseData => {
                    let str = '';
                    responseData.gptable.forEach(i => {
                        count = i.count;
                        str += content_tp2(i);
                    })
                    $('#groupproducttable').html(str);
                    console.log(responseData);
                })
        };
        const getData2 = (id) => {
            let UrlGetID = `https://${v_url}/api/gporder/${id}`
            sendHttpRequest('get', UrlGetID)

                .then(responseData => {
                    let str = '';
                    responseData.gotable.forEach(i => {
                        count = i.count;
                        str += content_tp3(i);
                    })
                    $('#groupordertable').html(str);
                    console.log(responseData);
                })
        };
        const sendData3 = () => {
            if (!document.getElementById("neworderquantity").value) {
                alert('請填入訂購數量!');
                // } else if (!document.getElementById("neworderdate").value) {
                //     alert("請輸入訂購日期")
            }
            // else if (!document.getElementById("neworderquantity").value) {
            //     alert("請輸入訂購數量")
            // } else if (!document.getElementById("newordermemberid").value) {
            //     alert("請輸入人編號")
            // } else if (!document.getElementById("newordermemberid").value) {
            //     alert("請輸入訂購狀態")
            // }
            else {

                sendHttpRequest('post', 'https://' + v_url + '/api/gporder', {
                    "newordergroupid": document.getElementById("newordergroupid").value,
                    "neworderproductid": document.getElementById("neworderproductid").value,
                    "neworderquantity": document.getElementById("neworderquantity").value,
                    // "neworderdate": document.getElementById("neworderdate").value,
                    "neworderdate": Date.now(),
                    "neworderstate": 1,
                    "newordermemberid": document.getElementById("vmn").value,
                    //  "newordermemberid": 60,
                    //  "newproductpictureurl": document.getElementById("newproductpictureurl").value,

                }).then(responseData => {
                    //再次從server取資料
                    $('#creatorder').modal("hide");
                    $(".modal-backdrop").remove();
                    //$('#productlistu').modal("hide");

                    console.log(responseData)
                    request.onload = getData();
                    window.location.href = "/cBlog/Purchase_FollowList";
                }).catch(err => {
                    console.log(err, err.data);
                });
            }
        };
        const content_tpl = tpl => {
            return `


            <div class="card" style="width: 350px;margin-left:90px;margin-right:20px;margin-top:30px;border-radius:15px;">

                <div class="card-body1">
                <div></div>
                <div>
                 <h5 class="card-title">${tpl.grouptitle}</h5>

                </div>

                    <div></div>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item "><span class="lgi1">團購說明</span>${tpl.groupdescription}</li>
                    <li class="list-group-item " ><span class="lgi1">開始日期</span>${tpl.groupstartdate}</li>
                    <li class="list-group-item "><span class="lgi1">截止日期</span>${tpl.groupenddate}</li>
                    </ul>
                <div class="card-body2">
                        <span class="lastday">還剩${tpl.countdown}天</span>
                    <button onclick="getData1(${tpl.groupid})" type="button" class="btn btn-primary" data-toggle="modal"
                        data-target="#productlistu">看商品資料</button>

                </div>
            </div>


          `
        };
        // ${tpl.product.gproducttable.map(p => `
        //                <span>${p.currentnum}</span>
        //         `)
        //         }
        const content_tp2 = tp2 => {
            return `
                            <tr >
                                <td >${tp2.groupid}</td>
                                <td >${tp2.productid}</td>
                                <td contentEditable="true" id="productname_${tp2.productid}">${tp2.productname}</td>
                                <td contentEditable="true" id="productprice_${tp2.productid}">${tp2.productprice}</td>
                                <td contentEditable="true" id="productcurrentnum_${tp2.productid}">${tp2.productcurrentnum}</td>

                                <td contentEditable="true" id="productdescription_${tp2.productid}">${tp2.productdescription}</td>
                                <td contentEditable="true" id="productpictureurl_${tp2.productid}"><img src=${tp2.productpictureurl} style="width:100px;height:100px;" class="imgproduct"></td>
                                <td ><button onclick="ddd(${tp2.groupid},${tp2.productid})"  type="button" class="btn btn-primary" >新增商品訂單</button></td>
                                <td><input type="button" id="fakebtn" data-toggle="modal" data-target="#creatorder" style="display:none;"></td>


                            </tr>
`}

        request.onload = getData();


        function ddd(id, id2) {


            $('#productlistu').modal('hide');
            $(".modal-backdrop").remove();
            document.getElementById("newordergroupid").value = id;
            document.getElementById("neworderproductid").value = id2;

            document.getElementById("neworderproductname").value = document.getElementById(`productname_${id2}`).innerText;

            $('#fakebtn').click();
        }

    </script>
</body>

</html>